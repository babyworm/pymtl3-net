# Medium-scale Example 1: Server SoC
# 16 Initiators, 8 Targets
# Use case: High-performance server processor with multiple accelerators

network: 'Irregular'
num_nodes: 57

nodes:
  # === Initiators (16) ===
  - id: 0
    type: "Initiator"
    name: "CPU_Core0"
    avg_throughput: 4.0
    max_throughput: 8.0
    latency_requirement: 30
    priority: 0
    traffic_pattern: "bursty"

  - id: 1
    type: "Initiator"
    name: "CPU_Core1"
    avg_throughput: 4.0
    max_throughput: 8.0
    latency_requirement: 30
    priority: 0
    traffic_pattern: "bursty"

  - id: 2
    type: "Initiator"
    name: "CPU_Core2"
    avg_throughput: 4.0
    max_throughput: 8.0
    latency_requirement: 30
    priority: 0
    traffic_pattern: "bursty"

  - id: 3
    type: "Initiator"
    name: "CPU_Core3"
    avg_throughput: 4.0
    max_throughput: 8.0
    latency_requirement: 30
    priority: 0
    traffic_pattern: "bursty"

  - id: 4
    type: "Initiator"
    name: "GPU_Compute"
    avg_throughput: 20.0
    max_throughput: 40.0
    latency_requirement: 50
    priority: 1
    traffic_pattern: "streaming"

  - id: 5
    type: "Initiator"
    name: "AI_Accelerator0"
    avg_throughput: 15.0
    max_throughput: 30.0
    latency_requirement: 45
    priority: 1
    traffic_pattern: "bursty"

  - id: 6
    type: "Initiator"
    name: "AI_Accelerator1"
    avg_throughput: 15.0
    max_throughput: 30.0
    latency_requirement: 45
    priority: 1
    traffic_pattern: "bursty"

  - id: 7
    type: "Initiator"
    name: "PCIe_Gen5_Controller0"
    avg_throughput: 12.0
    max_throughput: 24.0
    latency_requirement: 60
    priority: 1
    traffic_pattern: "bursty"

  - id: 8
    type: "Initiator"
    name: "PCIe_Gen5_Controller1"
    avg_throughput: 12.0
    max_throughput: 24.0
    latency_requirement: 60
    priority: 1
    traffic_pattern: "bursty"

  - id: 9
    type: "Initiator"
    name: "DMA_Engine0"
    avg_throughput: 8.0
    max_throughput: 16.0
    latency_requirement: 40
    priority: 2
    traffic_pattern: "streaming"

  - id: 10
    type: "Initiator"
    name: "DMA_Engine1"
    avg_throughput: 8.0
    max_throughput: 16.0
    latency_requirement: 40
    priority: 2
    traffic_pattern: "streaming"

  - id: 11
    type: "Initiator"
    name: "100G_Ethernet0"
    avg_throughput: 10.0
    max_throughput: 20.0
    latency_requirement: 35
    priority: 1
    traffic_pattern: "bursty"

  - id: 12
    type: "Initiator"
    name: "100G_Ethernet1"
    avg_throughput: 10.0
    max_throughput: 20.0
    latency_requirement: 35
    priority: 1
    traffic_pattern: "bursty"

  - id: 13
    type: "Initiator"
    name: "NVMe_Controller0"
    avg_throughput: 6.0
    max_throughput: 12.0
    latency_requirement: 80
    priority: 2
    traffic_pattern: "bursty"

  - id: 14
    type: "Initiator"
    name: "NVMe_Controller1"
    avg_throughput: 6.0
    max_throughput: 12.0
    latency_requirement: 80
    priority: 2
    traffic_pattern: "bursty"

  - id: 15
    type: "Initiator"
    name: "Security_Engine"
    avg_throughput: 3.0
    max_throughput: 6.0
    latency_requirement: 100
    priority: 2
    traffic_pattern: "bursty"

  # === NIUs (16) - One per initiator ===
  - id: 16
    type: "NIU"
    name: "CPU0_NIU"
    width: 64
    clock_domain: "cpu_clk"

  - id: 17
    type: "NIU"
    name: "CPU1_NIU"
    width: 64
    clock_domain: "cpu_clk"

  - id: 18
    type: "NIU"
    name: "CPU2_NIU"
    width: 64
    clock_domain: "cpu_clk"

  - id: 19
    type: "NIU"
    name: "CPU3_NIU"
    width: 64
    clock_domain: "cpu_clk"

  - id: 20
    type: "NIU"
    name: "GPU_NIU"
    width: 256
    clock_domain: "gpu_clk"

  - id: 21
    type: "NIU"
    name: "AI0_NIU"
    width: 128
    clock_domain: "ai_clk"

  - id: 22
    type: "NIU"
    name: "AI1_NIU"
    width: 128
    clock_domain: "ai_clk"

  - id: 23
    type: "NIU"
    name: "PCIe0_NIU"
    width: 128
    clock_domain: "pcie_clk"

  - id: 24
    type: "NIU"
    name: "PCIe1_NIU"
    width: 128
    clock_domain: "pcie_clk"

  - id: 25
    type: "NIU"
    name: "DMA0_NIU"
    width: 128
    clock_domain: "dma_clk"

  - id: 26
    type: "NIU"
    name: "DMA1_NIU"
    width: 128
    clock_domain: "dma_clk"

  - id: 27
    type: "NIU"
    name: "ETH0_NIU"
    width: 128
    clock_domain: "eth_clk"

  - id: 28
    type: "NIU"
    name: "ETH1_NIU"
    width: 128
    clock_domain: "eth_clk"

  - id: 29
    type: "NIU"
    name: "NVMe0_NIU"
    width: 64
    clock_domain: "nvme_clk"

  - id: 30
    type: "NIU"
    name: "NVMe1_NIU"
    width: 64
    clock_domain: "nvme_clk"

  - id: 31
    type: "NIU"
    name: "Security_NIU"
    width: 64
    clock_domain: "cpu_clk"

  # === Target NIUs (8) ===
  - id: 32
    type: "NIU"
    name: "DDR0_NIU"
    width: 256
    clock_domain: "ddr_clk"

  - id: 33
    type: "NIU"
    name: "DDR1_NIU"
    width: 256
    clock_domain: "ddr_clk"

  - id: 34
    type: "NIU"
    name: "HBM_NIU"
    width: 512
    clock_domain: "hbm_clk"

  - id: 35
    type: "NIU"
    name: "L3_Cache_NIU"
    width: 128
    clock_domain: "cpu_clk"

  - id: 36
    type: "NIU"
    name: "SLC_NIU"
    width: 256
    clock_domain: "noc_clk"

  - id: 37
    type: "NIU"
    name: "NVRAM_NIU"
    width: 64
    clock_domain: "nvme_clk"

  - id: 38
    type: "NIU"
    name: "ROM_NIU"
    width: 32
    clock_domain: "cpu_clk"

  - id: 39
    type: "NIU"
    name: "Flash_NIU"
    width: 32
    clock_domain: "cpu_clk"

  # === Routers (6) ===
  - id: 40
    type: "Router"
    name: "CPU_Router"
    width: 64
    clock_domain: "cpu_clk"
    num_ports: 5

  - id: 41
    type: "Router"
    name: "GPU_Router"
    width: 256
    clock_domain: "noc_clk"
    num_ports: 4

  - id: 42
    type: "Router"
    name: "AI_Router"
    width: 128
    clock_domain: "ai_clk"
    num_ports: 4

  - id: 43
    type: "Router"
    name: "IO_Router"
    width: 128
    clock_domain: "pcie_clk"
    num_ports: 5

  - id: 44
    type: "Router"
    name: "Memory_Router0"
    width: 256
    clock_domain: "noc_clk"
    num_ports: 4

  - id: 45
    type: "Router"
    name: "Memory_Router1"
    width: 256
    clock_domain: "noc_clk"
    num_ports: 4

  # === Arbiters (4) ===
  - id: 46
    type: "Arbiter"
    name: "CPU_Cluster_Arbiter"
    num_inputs: 4
    width: 64
    clock_domain: "cpu_clk"
    policy: "round_robin"

  - id: 47
    type: "Arbiter"
    name: "AI_Arbiter"
    num_inputs: 2
    width: 128
    clock_domain: "ai_clk"
    policy: "round_robin"

  - id: 48
    type: "Arbiter"
    name: "DDR_Arbiter"
    num_inputs: 4
    width: 256
    clock_domain: "noc_clk"
    policy: "priority"

  - id: 49
    type: "Arbiter"
    name: "IO_Arbiter"
    num_inputs: 4
    width: 128
    clock_domain: "pcie_clk"
    policy: "round_robin"

  # === Decoders (2) ===
  - id: 50
    type: "Decoder"
    name: "Memory_Decoder"
    num_outputs: 4
    width: 256
    clock_domain: "noc_clk"

  - id: 51
    type: "Decoder"
    name: "Storage_Decoder"
    num_outputs: 3
    width: 64
    clock_domain: "cpu_clk"

  # === Width Converters (2) ===
  - id: 52
    type: "WidthConverter"
    name: "GPU_WidthConv"
    src_width: 256
    dst_width: 512
    clock_domain: "noc_clk"

  - id: 53
    type: "WidthConverter"
    name: "Storage_WidthConv"
    src_width: 64
    dst_width: 128
    clock_domain: "cpu_clk"

  # === Clock Converters (2) ===
  - id: 54
    type: "ClockConverter"
    name: "CPU_NOC_CDC"
    src_domain: "cpu_clk"
    dst_domain: "noc_clk"
    width: 64

  - id: 55
    type: "ClockConverter"
    name: "IO_NOC_CDC"
    src_domain: "pcie_clk"
    dst_domain: "noc_clk"
    width: 128

  # === Targets (8) ===
  - id: 56
    type: "Target"
    name: "DDR5_Channel0"
    max_bandwidth: 51.2
    latency: 80
    size: 32
    type_detail: "DDR5"

  - id: 57
    type: "Target"
    name: "DDR5_Channel1"
    max_bandwidth: 51.2
    latency: 80
    size: 32
    type_detail: "DDR5"

  - id: 58
    type: "Target"
    name: "HBM3"
    max_bandwidth: 819.2
    latency: 40
    size: 16
    type_detail: "HBM3"

  - id: 59
    type: "Target"
    name: "L3_Cache"
    max_bandwidth: 200.0
    latency: 15
    size: 0.128
    type_detail: "SRAM"

  - id: 60
    type: "Target"
    name: "System_Cache"
    max_bandwidth: 400.0
    latency: 20
    size: 0.256
    type_detail: "SRAM"

  - id: 61
    type: "Target"
    name: "NVRAM"
    max_bandwidth: 12.0
    latency: 120
    size: 128
    type_detail: "NVRAM"

  - id: 62
    type: "Target"
    name: "Boot_ROM"
    max_bandwidth: 2.0
    latency: 50
    size: 0.016
    type_detail: "ROM"

  - id: 63
    type: "Target"
    name: "Config_Flash"
    max_bandwidth: 0.5
    latency: 300
    size: 0.256
    type_detail: "Flash"

graph:
  edges:
    # Initiator → NIU
    - {src: 0, dst: 16, width: 64, latency: 1}
    - {src: 1, dst: 17, width: 64, latency: 1}
    - {src: 2, dst: 18, width: 64, latency: 1}
    - {src: 3, dst: 19, width: 64, latency: 1}
    - {src: 4, dst: 20, width: 256, latency: 1}
    - {src: 5, dst: 21, width: 128, latency: 1}
    - {src: 6, dst: 22, width: 128, latency: 1}
    - {src: 7, dst: 23, width: 128, latency: 1}
    - {src: 8, dst: 24, width: 128, latency: 1}
    - {src: 9, dst: 25, width: 128, latency: 1}
    - {src: 10, dst: 26, width: 128, latency: 1}
    - {src: 11, dst: 27, width: 128, latency: 1}
    - {src: 12, dst: 28, width: 128, latency: 1}
    - {src: 13, dst: 29, width: 64, latency: 1}
    - {src: 14, dst: 30, width: 64, latency: 1}
    - {src: 15, dst: 31, width: 64, latency: 1}

    # CPU cluster → CPU Arbiter
    - {src: 16, dst: 46, width: 64, latency: 1}
    - {src: 17, dst: 46, width: 64, latency: 1}
    - {src: 18, dst: 46, width: 64, latency: 1}
    - {src: 19, dst: 46, width: 64, latency: 1}
    - {src: 46, dst: 40, width: 64, latency: 2}

    # CPU Router connections
    - {src: 31, dst: 40, width: 64, latency: 1}
    - {src: 40, dst: 54, width: 64, latency: 1}
    - {src: 54, dst: 44, width: 64, latency: 3}

    # GPU path
    - {src: 20, dst: 41, width: 256, latency: 1}
    - {src: 41, dst: 52, width: 256, latency: 1}
    - {src: 52, dst: 34, width: 512, latency: 2}

    # AI accelerators → AI Arbiter
    - {src: 21, dst: 47, width: 128, latency: 1}
    - {src: 22, dst: 47, width: 128, latency: 1}
    - {src: 47, dst: 42, width: 128, latency: 2}
    - {src: 42, dst: 44, width: 128, latency: 1}

    # IO devices → IO Arbiter
    - {src: 23, dst: 49, width: 128, latency: 1}
    - {src: 24, dst: 49, width: 128, latency: 1}
    - {src: 27, dst: 49, width: 128, latency: 1}
    - {src: 28, dst: 49, width: 128, latency: 1}
    - {src: 49, dst: 43, width: 128, latency: 2}

    # DMA engines → IO Router
    - {src: 25, dst: 43, width: 128, latency: 1}
    - {src: 26, dst: 43, width: 128, latency: 1}

    # IO Router → NoC
    - {src: 43, dst: 55, width: 128, latency: 1}
    - {src: 55, dst: 45, width: 128, latency: 3}

    # Storage path
    - {src: 29, dst: 51, width: 64, latency: 1}
    - {src: 30, dst: 51, width: 64, latency: 1}
    - {src: 51, dst: 53, width: 64, latency: 1}
    - {src: 53, dst: 45, width: 128, latency: 2}

    # Memory Router interconnect
    - {src: 44, dst: 45, width: 256, latency: 1}
    - {src: 45, dst: 44, width: 256, latency: 1}

    # Memory Routers → Memory Arbiter
    - {src: 44, dst: 48, width: 256, latency: 1}
    - {src: 45, dst: 48, width: 256, latency: 1}
    - {src: 41, dst: 48, width: 256, latency: 1}
    - {src: 42, dst: 48, width: 128, latency: 1}

    # Memory Arbiter → Memory Decoder
    - {src: 48, dst: 50, width: 256, latency: 2}

    # Memory Decoder → Target NIUs
    - {src: 50, dst: 32, width: 256, latency: 1}
    - {src: 50, dst: 33, width: 256, latency: 1}
    - {src: 50, dst: 36, width: 256, latency: 1}
    - {src: 50, dst: 35, width: 256, latency: 1}

    # Direct paths
    - {src: 40, dst: 35, width: 64, latency: 2}
    - {src: 51, dst: 37, width: 64, latency: 1}
    - {src: 40, dst: 38, width: 64, latency: 3}
    - {src: 40, dst: 39, width: 64, latency: 3}

    # Target NIUs → Targets
    - {src: 32, dst: 56, width: 256, latency: 8}
    - {src: 33, dst: 57, width: 256, latency: 8}
    - {src: 34, dst: 58, width: 512, latency: 4}
    - {src: 35, dst: 59, width: 128, latency: 3}
    - {src: 36, dst: 60, width: 256, latency: 4}
    - {src: 37, dst: 61, width: 64, latency: 10}
    - {src: 38, dst: 62, width: 32, latency: 5}
    - {src: 39, dst: 63, width: 32, latency: 15}

constraints:
  niu_entry_only: true

  clock_domains:
    - {name: "cpu_clk", frequency: 3000}
    - {name: "gpu_clk", frequency: 2000}
    - {name: "ai_clk", frequency: 1500}
    - {name: "noc_clk", frequency: 2000}
    - {name: "ddr_clk", frequency: 3200}
    - {name: "hbm_clk", frequency: 3200}
    - {name: "pcie_clk", frequency: 1000}
    - {name: "eth_clk", frequency: 1000}
    - {name: "dma_clk", frequency: 1500}
    - {name: "nvme_clk", frequency: 800}

  enforce_width_match: false
  max_end_to_end_latency: 200

  bandwidth_allocation:
    - {initiator: 4, target: 58, guaranteed_bw: 20.0, max_latency: 70, priority: 1}
    - {initiator: 5, target: 58, guaranteed_bw: 15.0, max_latency: 65, priority: 1}
    - {initiator: 6, target: 58, guaranteed_bw: 15.0, max_latency: 65, priority: 1}
    - {initiator: 0, target: 59, guaranteed_bw: 4.0, max_latency: 50, priority: 0}
    - {initiator: 1, target: 60, guaranteed_bw: 4.0, max_latency: 55, priority: 0}
    - {initiator: 7, target: 56, guaranteed_bw: 12.0, max_latency: 100, priority: 1}
    - {initiator: 8, target: 57, guaranteed_bw: 12.0, max_latency: 100, priority: 1}
    - {initiator: 11, target: 56, guaranteed_bw: 10.0, max_latency: 70, priority: 1}
    - {initiator: 13, target: 61, guaranteed_bw: 6.0, max_latency: 180, priority: 2}
    - {initiator: 14, target: 61, guaranteed_bw: 6.0, max_latency: 180, priority: 2}

  validate_bandwidth: true
  validate_latency: true
